<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: DailyOverview/DailyJS.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: DailyOverview/DailyJS.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>window.img = new Array(); // used to load image from &lt;input> and draw to canvas
var input = document.getElementById('image-input');
let canvas = document.getElementById('myCanvas');
let canv = canvas.getContext('2d');

//get the desired mm/dd/yyyy string
let myLocation = window.location.href;
let currentDateStr = myLocation.substring(
    myLocation.length - 10,
    myLocation.length
);
//default case
if (currentDateStr == 'html') {
    currentDateStr = '05/25/2020';
}
console.log(currentDateStr);

let relative = 0;
// Buttons
const add = document.getElementById('addPhoto');
const save = document.getElementById('save');
const right = document.getElementById('right');
const left = document.getElementById('left');

// store current day data to update when user leaves page
let currentDay;
//  = {
//     date: "05/20/2021",
//     bullets: [
//         {
//             text: "O, Wonder!",
//             symb: "•",
//             done: true,
//             childList: [],
//             time: null
//         }
//     ],
//     photos: [],
//     notes: "Here is some notes sample test this is a note possibly here could be another"
// }

window.addEventListener('load', () => {
    // getting backend sample day
    let dbPromise = initDB();
    dbPromise.onsuccess = function (e) {
        console.log('database connected');
        setDB(e.target.result);
        requestDay();
        fetchMonthGoals();
        fetchYearGoals();
    };
    document.getElementById('date').innerHTML = 'Today: ' + currentDateStr;
});

/**
 * Gets the current day object (and creates one if one doesn't exist)
 * and sets the "currentDay" variable
 * Also renders the days notes and bullets if there are any
 * @returns void
 */
function requestDay() {
    let req = getDay(currentDateStr);
    req.onsuccess = function (e) {
        console.log('got day');
        console.log(e.target.result);
        currentDay = e.target.result;
        if (currentDay === undefined) {
            currentDay = initDay(currentDateStr);
            createDay(currentDay);
        } else {
            //Load in bullets
            let bullets = currentDay.bullets;
            renderBullets(bullets);
            // Load in notes
            let newNote = document.createElement('note-box');
            newNote.entry = currentDay.notes;
            document.querySelector('#notes').appendChild(newNote);

            // Load photos
            let photos = currentDay.photos;
            renderPhotos(photos);
        }
    };
}

/**
 * Gets the current month object (and creates one if one doesn't exist)
 * also renders the monthly goals
 * @returns void
 */
function fetchMonthGoals() {
    console.log('fetching month');
    console.log(currentDateStr.substring(6));
    let monthStr = currentDateStr.substring(0, 3) + currentDateStr.substring(6);
    let req = getMonthlyGoals(monthStr);
    req.onsuccess = function (e) {
        console.log('got month');
        let monthObj = e.target.result;
        console.log(monthObj);
        if (monthObj === undefined) {
            createMonthlyGoals(initMonth(monthStr));
        } else {
            //load in bullets
            monthObj.goals.forEach((goal) => {
                console.log('here is a goal', goal);
                let goalElem = document.createElement('p');
                goalElem.innerHTML = goal.text;
                if (goal.done === true) {
                    goalElem.style.textDecoration = 'line-through';
                }
                goalElem.classList.add('month-goal');
                console.log(goalElem);
                document.querySelector('#monthGoal').appendChild(goalElem);
            });
        }
    };
}

/**
 * Gets the current year object (and creates one if one doesn't exist)
 * also renders the yearly goals
 * @returns void
 */
function fetchYearGoals() {
    console.log('fetching year');
    let yearStr = currentDateStr.substring(6);
    let req = getYearlyGoals(yearStr);
    req.onsuccess = function (e) {
        console.log('got year');
        let yearObj = e.target.result;
        console.log(yearObj);
        if (yearObj === undefined) {
            createYearlyGoals(initYear(yearStr));
        } else {
            //load in bullets
            yearObj.goals.forEach((goal) => {
                console.log('here is a goal', goal);
                let goalElem = document.createElement('p');
                goalElem.innerHTML = goal.text;
                if (goal.done === true) {
                    goalElem.style.textDecoration = 'line-through';
                }
                goalElem.classList.add('year-goal');
                console.log(goalElem);
                document.querySelector('#yearGoal').appendChild(goalElem);
            });
        }
    };
}

/* Here is another version of what to do when the window loads, TODO, merge these into one
window.onload = () => {
    // eslint-disable-next-line no-undef
    let req = getDay('05/20/2021');
    req.onsuccess = function (e) {
        console.log('got day');
        console.log(e.target.result);
        let bullets = e.target.result.bullets;
        let photos = e.target.result.photos;
        renderPhotos(photos);

        renderBullets(bullets);
    };
};
*/

document.getElementById('notesb').addEventListener('click', () => {
    // var divs = document.getElementsByClassName('divs');
    // for (var i = 0; i &lt; arrows.length; i++) {
    //     if (this != arrows[i]) {
    //         arrows[i].style.display = 'none';
    //     }
    // }
    updateNote();
    updateDay(currentDay);
});

document.querySelector('.entry-form').addEventListener('submit', (submit) => {
    submit.preventDefault();
    let bText = document.querySelector('.entry-form-text').value;
    document.querySelector('.entry-form-text').value = '';
    currentDay.bullets.push({
        text: bText,
        symb: '•',
        done: false,
        childList: [],
        time: null,
    });
    console.log(currentDay);
    document.querySelector('#bullets').innerHTML = '';
    renderBullets(currentDay.bullets);
    updateDay(currentDay);
});

// lets bullet component listen to when a bullet child is added
document.querySelector('#bullets').addEventListener('added', function (e) {
    console.log('got event');
    console.log(e.composedPath());
    let newJson = JSON.parse(e.composedPath()[0].getAttribute('bulletJson'));
    let index = JSON.parse(e.composedPath()[0].getAttribute('index'));
    currentDay.bullets[index[0]] = newJson;
    updateDay(currentDay);
});

// lets bullet component listen to when a bullet is deleted
document.querySelector('#bullets').addEventListener('deleted', function (e) {
    console.log('got event');
    console.log(e.composedPath());
    let index = JSON.parse(e.composedPath()[0].getAttribute('index'));
    let firstIndex = index[0];
    if (index.length > 1) {
        let secondIndex = index[1];
        currentDay.bullets[firstIndex].childList.splice(secondIndex, 1);
    } else {
        currentDay.bullets.splice(firstIndex, 1);
    }
    updateDay(currentDay);
    document.querySelector('#bullets').innerHTML = '';
    renderBullets(currentDay.bullets);
});

// lets bullet component listen to when a bullet is edited
document.querySelector('#bullets').addEventListener('edited', function (e) {
    console.log('got event');
    console.log(e.composedPath()[0]);
    let newText = JSON.parse(e.composedPath()[0].getAttribute('bulletJson'))
        .text;
    let index = JSON.parse(e.composedPath()[0].getAttribute('index'));
    let firstIndex = index[0];
    if (index.length > 1) {
        let secondIndex = index[1];
        currentDay.bullets[firstIndex].childList[secondIndex].text = newText;
    } else {
        currentDay.bullets[firstIndex].text = newText;
    }
    updateDay(currentDay);
    document.querySelector('#bullets').innerHTML = '';
    renderBullets(currentDay.bullets);
});

// lets bullet component listen to when a bullet is marked done
document.querySelector('#bullets').addEventListener('done', function (e) {
    console.log('got done event');
    console.log(e.composedPath()[0]);
    let index = JSON.parse(e.composedPath()[0].getAttribute('index'));
    let firstIndex = index[0];
    if (index.length > 1) {
        let secondIndex = index[1];
        currentDay.bullets[firstIndex].childList[secondIndex].done ^= true;
    } else {
        currentDay.bullets[firstIndex].done ^= true;
    }
    updateDay(currentDay);
    document.querySelector('#bullets').innerHTML = '';
    renderBullets(currentDay.bullets);
});

/**
 * Function that renders a list of bullets into the todo area
 * Update currentDay json with updated bullets
 * @param {Object} bullets - a list of bullet objects to render
 */
function renderBullets(bullets) {
    let iNum = 0;
    bullets.forEach((bullet) => {
        let i = [iNum];
        let newPost = document.createElement('bullet-entry');
        newPost.setAttribute('bulletJson', JSON.stringify(bullet));
        newPost.setAttribute('index', JSON.stringify(i));
        newPost.entry = bullet;
        console.log(bullet);
        if (bullet.childList.length != 0) {
            i.push(0);
            bullet.childList.forEach((child) => {
                let newChild = renderChild(child, i);
                newPost.child = newChild;
                i[i.length - 1]++;
            });
        }
        console.log(newPost);
        document.querySelector('#bullets').appendChild(newPost);
        iNum++;
    });
}

/**
 * Function that recursively renders the nested bullets of a given bullet
 * @param {Object} bullet - a bullet object of child to create
 * @param {Number} i -  array of integers of index of bullets
 * @return {Object} new child created
 */
function renderChild(bullet, i) {
    let newChild = document.createElement('bullet-entry');
    newChild.setAttribute('bulletJson', JSON.stringify(bullet));
    newChild.setAttribute('index', JSON.stringify(i));
    newChild.entry = bullet;
    if (bullet.childList.length != 0) {
        i.push(0);
        bullet.childList.forEach((child) => {
            let newNewChild = renderChild(child, i);
            newChild.child = newNewChild;
            i[i.length - 1]++;
        });
    }
    console.log(newChild);
    return newChild;
}

// eslint-disable-next-line no-unused-vars
function editBullet() {
    console.log('in here');
    let editedEntry = prompt(
        'Edit Bullet',
        this.shadowRoot.querySelector('.bullet-content').innerText
    );
    if (editedEntry != null &amp;&amp; editedEntry != '') {
        this.shadowRoot.querySelector(
            '.bullet-content'
        ).innerText = editedEntry;
    }
}

/**
 * Function that updates the notes
 */
function updateNote() {
    let currNote = document
        .querySelector('note-box')
        .shadowRoot.querySelector('.noteContent').innerHTML;
    currentDay.notes = currNote;
}

input.addEventListener('change', (event) => {
    window.img[relative] = new Image();

    // This allows you to store blob -> base64
    var reader = new FileReader();
    reader.readAsDataURL(event.target.files[0]);
    reader.onloadend = function () {
        var base64data = reader.result;
        window.img[relative].src = base64data;
    };
});
// Add an image to the canvas
add.addEventListener('click', () => {
    input.type = 'file';
    save.style.display = 'inline';
    canv.clearRect(0, 0, canvas.width, canvas.height);
    relative = window.img.length;
});
// Save image and will hide everything else
// REQUIRED TO PRESS SAVE AFTER UPLOAD
save.addEventListener('click', () => {
    input.type = 'hidden';
    save.style.display = 'none';

    let imgDimension = getDimensions(
        canvas.width,
        canvas.height,
        window.img[relative].width,
        window.img[relative].height
    );
    canv.drawImage(
        window.img[relative],
        imgDimension['startX'],
        imgDimension['startY'],
        imgDimension['width'],
        imgDimension['height']
    );

    // Add Item and update whenever save
    currentDay.photos.push(window.img[relative].src);
    updateDay(currentDay);
});
left.addEventListener('click', () => {
    relative -= 1;
    if (relative == -1) {
        relative = window.img.length - 1;
    }
    canv.clearRect(0, 0, canvas.width, canvas.height);
    if (window.img[relative]) {
        var imgDimension = getDimensions(
            canvas.width,
            canvas.height,
            window.img[relative].width,
            window.img[relative].height
        );
        canv.drawImage(
            window.img[relative],
            imgDimension['startX'],
            imgDimension['startY'],
            imgDimension['width'],
            imgDimension['height']
        );
    }
});
right.addEventListener('click', () => {
    relative += 1;
    if (relative == window.img.length) {
        relative = 0;
    }
    canv.clearRect(0, 0, canvas.width, canvas.height);
    if (window.img[relative]) {
        var imgDimension = getDimensions(
            canvas.width,
            canvas.height,
            window.img[relative].width,
            window.img[relative].height
        );
        canv.drawImage(
            window.img[relative],
            imgDimension['startX'],
            imgDimension['startY'],
            imgDimension['width'],
            imgDimension['height']
        );
    }
});

/**
 * Takes in the dimensions of the canvas and the new image, then calculates the new
 * dimensions of the image so that it fits perfectly into the Canvas and maintains aspect ratio
 * @param {number} canvasWidth Width of the canvas element to insert image into
 * @param {number} canvasHeight Height of the canvas element to insert image into
 * @param {number} imageWidth Width of the new user submitted image
 * @param {number} imageHeight Height of the new user submitted image
 * @returns {Object} An object containing four properties: The newly calculated width and height,
 * and also the starting X and starting Y coordinate to be used when you draw the new image to the
 * Canvas. These coordinates align with the top left of the image.
 */
function getDimensions(canvasWidth, canvasHeight, imageWidth, imageHeight) {
    let aspectRatio, height, width, startX, startY;

    // Get the aspect ratio, used so the picture always fits inside the canvas
    aspectRatio = imageWidth / imageHeight;

    // If the apsect ratio is less than 1 it's a verical image
    if (aspectRatio &lt; 1) {
        // Height is the max possible given the canvas
        height = canvasHeight;
        // Width is then proportional given the height and aspect ratio
        width = canvasHeight * aspectRatio;
        // Start the Y at the top since it's max height, but center the width
        startY = 0;
        startX = (canvasWidth - width) / 2;
        // This is for horizontal images now
    } else {
        // Width is the maximum width possible given the canvas
        width = canvasWidth;
        // Height is then proportional given the width and aspect ratio
        height = canvasWidth / aspectRatio;
        // Start the X at the very left since it's max width, but center the height
        startX = 0;
        startY = (canvasHeight - height) / 2;
    }

    return { width: width, height: height, startX: startX, startY: startY };
}

//set back button
document.getElementById('monthView').children[0].href +=
    '#' + currentDateStr.substring(0, 2) + '/' + currentDateStr.substring(6);

/**
 * Function that gets photos and renders
 * @param {Object} photos takes in photo object
 * @return nothing
 */
// eslint-disable-next-line no-unused-vars
function renderPhotos(photos) {
    for (let i = 0; i &lt; photos.length; i++) {
        window.img[i] = new Image();
        window.img[i].src = photos[i];
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createDay">createDay</a></li><li><a href="global.html#createMonthlyGoals">createMonthlyGoals</a></li><li><a href="global.html#createSettings">createSettings</a></li><li><a href="global.html#createYearlyGoals">createYearlyGoals</a></li><li><a href="global.html#dayNumber">dayNumber</a></li><li><a href="global.html#db">db</a></li><li><a href="global.html#DB_NAME">DB_NAME</a></li><li><a href="global.html#DB_VERSION">DB_VERSION</a></li><li><a href="global.html#deleteDay">deleteDay</a></li><li><a href="global.html#deleteMockData">deleteMockData</a></li><li><a href="global.html#deleteMonthlyGoals">deleteMonthlyGoals</a></li><li><a href="global.html#deleteSettings">deleteSettings</a></li><li><a href="global.html#deleteYearlyGoals">deleteYearlyGoals</a></li><li><a href="global.html#editMockData">editMockData</a></li><li><a href="global.html#fetchMonthGoals">fetchMonthGoals</a></li><li><a href="global.html#fetchYearGoals">fetchYearGoals</a></li><li><a href="global.html#firstDow">firstDow</a></li><li><a href="global.html#getDay">getDay</a></li><li><a href="global.html#getDimensions">getDimensions</a></li><li><a href="global.html#getMockData">getMockData</a></li><li><a href="global.html#getMonthlyGoals">getMonthlyGoals</a></li><li><a href="global.html#getSettings">getSettings</a></li><li><a href="global.html#getYearlyGoals">getYearlyGoals</a></li><li><a href="global.html#goHome">goHome</a></li><li><a href="global.html#handleLogin">handleLogin</a></li><li><a href="global.html#handleSignup">handleSignup</a></li><li><a href="global.html#initDay">initDay</a></li><li><a href="global.html#initDB">initDB</a></li><li><a href="global.html#initGoal">initGoal</a></li><li><a href="global.html#initMonth">initMonth</a></li><li><a href="global.html#initYear">initYear</a></li><li><a href="global.html#lastDow">lastDow</a></li><li><a href="global.html#mockHash">mockHash</a></li><li><a href="global.html#monthNumber">monthNumber</a></li><li><a href="global.html#renderBullets">renderBullets</a></li><li><a href="global.html#renderChild">renderChild</a></li><li><a href="global.html#renderGoals">renderGoals</a></li><li><a href="global.html#renderPhotos">renderPhotos</a></li><li><a href="global.html#requestDay">requestDay</a></li><li><a href="global.html#setDB">setDB</a></li><li><a href="global.html#setNewUser">setNewUser</a></li><li><a href="global.html#setReturningUser">setReturningUser</a></li><li><a href="global.html#setupCalendar">setupCalendar</a></li><li><a href="global.html#setUpMockData">setUpMockData</a></li><li><a href="global.html#toggleView">toggleView</a></li><li><a href="global.html#updateDay">updateDay</a></li><li><a href="global.html#updateMonthlyGoals">updateMonthlyGoals</a></li><li><a href="global.html#updateNote">updateNote</a></li><li><a href="global.html#updateSettings">updateSettings</a></li><li><a href="global.html#updateYearsGoals">updateYearsGoals</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Wed May 26 2021 22:57:57 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
